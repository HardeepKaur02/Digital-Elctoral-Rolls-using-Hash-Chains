{% extends "base.html" %} {% block title %}Search{% endblock %} {% block
    content %}


<div class="container" style=" margin: auto; padding: 20px;">
    <div class="row" style="margin: auto;padding: 10px; display: inline-block; width: 100%; font: 2em; text-align: center;background-color: rgb(236, 122, 169); color: rgb(12, 8, 15); height: 50px;">
        Update voter by EPIC ID
    </div>
    <div id="by_epic" class="tab-pane panel panel-default fade in active show" style="height: 60%;margin: auto;background-color: cornsilk;">        
        <div class="panel-body" style="margin: auto;padding: 10px;">
            <div class="row form-group" style="margin: auto;padding: 5px;">

                <div class="col-md-3 col-xs-3 col-sm-3">
                    <label class="text-info">Epic Id.&nbsp;</label>
                </div>
                
                <div class="col-md-5 col-xs-5 col-sm-5">
                    <input type="text" id="epicno" name="epicno" required="required" class="form-control" placeholder="Enter Epic Id">
                </div>

                <div class="col-md-2 col-xs-2 col-sm-2 text-right" style="margin: auto;">
                    <button class="btn btn-success btn-sm" type="button" id="Search_btn"><i class="fa fa-search"></i>Search</button>
                </div>
                <div class="col-md-2 col-xs-2 col-sm-2" style="margin: auto;" >
                    <button class="btn btn-danger btn-sm" type="reset" id="Update_btn" >Update</button>
                </div>
                
            </div>
        </div>
        
        <div id="voter_data" style="display: none;">
            <div class="panel panel-primary">
                <div class="panel-heading" style="margin: auto;padding: 5px; font-size: 12pt;background-color:wheat;">
                    Voter Details
                </div>

                <div class="panel-body" style="margin: auto;padding: 10px;">
                    <div class="row" align="center">
                        <div class="col-md-8">
                            <div class="row" align="center">
                                <div class="col-md-6">
                                    <label class="text-info">Name : </label>
                                </div>
                                <div class="col-md-6">
                                    <label class="text-info">Father Name : </label>
                                </div>
                            </div>
                            <div class="row" align="center">
                                <div class="col-md-6">
                                    <input type="text" style="background-color:white" id="voter_name" name="voter_name"  class="form-control col-md-9 col-xs-12 " readonly="">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" style="background-color:white" id="voter_f_name" name="voter_father_name"  class="form-control col-md-9 col-xs-12 " readonly="">
                                </div>
                            </div>
                            <div class="row" align="center">
                                <div class="col-md-6">
                                    <input type="text" style="background-color:white" id="voter_name_2" name="voter_name"  class="form-control col-md-9 col-xs-12 " >
                                </div>
                                <div class="col-md-6">
                                    <input type="text" style="background-color:white" id="voter_f_name_2" name="voter_father_name"  class="form-control col-md-9 col-xs-12 " >
                                </div>
                            </div>

                            <div class="row" align="center">
                                <div class="col-md-6">
                                    <label class="text-info">Gender : </label>
                                </div>
                                <div class="col-md-6">
                                    <label class="text-info">Age: </label>
                                </div>
                            </div>
                            <div class="row" align="center">
                                <div class="col-md-6">
                                    <input type="text" style="background-color:white" id="gender" name="gender"  class="form-control col-md-9 col-xs-12 " readonly="">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" style="background-color:white" id="age" name="age"  class="form-control col-md-9 col-xs-12 " readonly="">
                                </div>
                            </div>
                            <div class="row" align="center">
                                <div class="col-md-6">
                                    <input type="text" style="background-color:white" id="gender_2" name="gender_2"  class="form-control col-md-9 col-xs-12 " >
                                </div>
                                <div class="col-md-6">
                                    <input type="text" style="background-color:white" id="age_2" name="age_2"  class="form-control col-md-9 col-xs-12 ">
                                </div>
                            </div>

                            <div class="row" align="center">
                                <div class="col-md-6">
                                    <label class="text-info">Address : </label>
                                </div>
                            </div>        
                            <div class="row" align="center">
                                <div class="col-md-6">
                                    <input type="text" style="background-color:white" id="address" name="address"  class="form-control col-md-9 col-xs-12 " readonly="">
                                </div>
                            </div>        
                            <div class="row" align="center">
                                <div class="col-md-6">
                                    <input type="text" style="background-color:white" id="address_2" name="address_2"  class="form-control col-md-9 col-xs-12 " >
                                </div>
                            </div>        

                        </div>
                        <div class="col-md-4">
                            <div class="row" align="center">
                                <div class="col-md-12">
                                    <label class="text-info">Photo : </label>
                                </div>
                            </div>        
                            <div class="row" align="center">
                                <div class="col-md-12">
                                    <input type="image" style="background-color:white; height: 225px;" id="voter_photo" name="voter_name"  class="form-control col-md-9 col-xs-12 " readonly="">
                                </div>
                            </div>        
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="constituency_data" style="display: none;">
            <div class="panel panel-primary">
                <div class="panel-heading" style="margin: auto;padding: 5px; font-size: 12pt;background-color:wheat;">
                    Constituency Details
                </div>
                <div class="panel-body" style="margin: auto;padding: 10px;">
                    <div class="row" align="center">
                        <div class="col-md-6">
                            <label class="text-info">Part Number : </label>
                        </div>
                        <div class="col-md-6">
                            <label class="text-info">Part Name : </label>
                        </div>
                    </div>

                    <div class="row" align="center">
                        <div class="col-md-6">
                            <input type="text" style="background-color:white" id="part_number" name="voter_name"  class="form-control col-md-9 col-xs-12 " readonly="">
                        </div>
                        <div class="col-md-6">
                            <input type="text" style="background-color:white" id="part_name" name="voter_name"  class="form-control col-md-9 col-xs-12 " readonly="">
                        </div>
                    </div>
                    <div class="row" align="center">
                        <div class="col-md-6">
                            <input type="text" style="background-color:white" id="part_number_2" name="voter_name"  class="form-control col-md-9 col-xs-12 " >
                        </div>
                        <div class="col-md-6">
                            <input type="text" style="background-color:white" id="part_name_2" name="voter_name"  class="form-control col-md-9 col-xs-12 " >
                        </div>
                    </div>

                    <div class="row" align="center">
                        <div class="col-md-6">
                            <label class="text-info">Assembly Constituency : </label>
                        </div>
                        <div class="col-md-6">
                            <label class="text-info">Parliamentary Constituency : </label>
                        </div>
                    </div>

                    <div class="row" align="center">
                        <div class="col-md-6">
                            <input type="text" style="background-color:white" id="ac_name" name="voter_name"  class="form-control col-md-9 col-xs-12 " readonly="">
                        </div>
                        <div class="col-md-6">
                            <input type="text" style="background-color:white" id="pc_name" name="voter_name"  class="form-control col-md-9 col-xs-12 " readonly="">
                        </div>
                    </div>
                    <div class="row" align="center">
                        <div class="col-md-6">
                            <input type="text" style="background-color:white" id="ac_name_2" name="voter_name"  class="form-control col-md-9 col-xs-12 " >
                        </div>
                        <div class="col-md-6">
                            <input type="text" style="background-color:white" id="pc_name_2" name="voter_name"  class="form-control col-md-9 col-xs-12 " >
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </div>
</div>

<script>
    function stateHandle() {
        if (document.getElementById("epicno").value==="") {
            document.getElementById("Search_btn").disabled = true; //button remains disabled
        } else {
            document.getElementById("Search_btn").disabled = false; //button is enabled
        }
    }        
    document.getElementById("epicno").addEventListener("change", stateHandle);
    
    document.getElementById('Search_btn').addEventListener('click', function(event) {
        var ref = 'http://127.0.0.1:5000/api/voters/';
        var voter_id = document.getElementById("epicno").value;
        fetch(ref.concat(voter_id)).then(response => response.json()).then(data => {
            document.getElementById("voter_name").value = data['name'];
            document.getElementById("voter_f_name").value = data['father_name'];
            document.getElementById("age").value = data['age'];
            document.getElementById("gender").value = data['gender'];
            document.getElementById("address").value = data['address'];
            document.getElementById("voter_data").style.display = 'block';
            document.getElementById("ac_name").value = data['assembly_constituency'];
            document.getElementById("pc_name").value = data['parliamentary_constituency'];
            document.getElementById("part_number").value = data['part_number'];
            document.getElementById("part_name").value = data['part_name'];
            document.getElementById("constituency_data").style.display = 'block';
            document.getElementById("voter_name_2").value = '';
            document.getElementById("voter_f_name_2").value ="";
            document.getElementById("voter_age_2").value ="";
            document.getElementById("voter_gender_2").value ="";
            document.getElementById("voter_address_2").value ="";
            document.getElementById("part_name_2").value = "";
            document.getElementById("part_number_2").value = "";
            document.getElementById("ac_name_2").value = "";
            document.getElementById("pc_name_2").value = "";

            console.log(data);
        });
        });        

        document.getElementById('Update_btn').addEventListener('click', function(event) {
        var ref = 'http://127.0.0.1:5000/api/voters/';
        var voter_id = document.getElementById("epicno").value;
        fetch(ref.concat(voter_id),{method: 'PUT',headers: {'Content-Type': 'application/json'},body: JSON.stringify({
            EPIC_ID: document.getElementById('epicno').value,
            name: document.getElementById('voter_name_2').value,
            age: document.getElementById('age_2').value,
            gender: document.getElementById('gender_2').value,
            address: document.getElementById('address_2').value,
            assembly_constituency: document.getElementById('ac_name_2').value,
            parliamentary_constituency: document.getElementById('pc_name_2').value,
            father_name: document.getElementById('voter_f_name_2').value,
            part_number: document.getElementById('part_number_2').value,
            part_name:  document.getElementById('part_name_2').value
        })}).then(response => {console.log(response);
            if(response.status == "200" || response.status == 200){
                alert("Voter updated successfully");  
            }
            else if(response.status == "231" || response.status == 231){
                alert("No update needed!");
            }
            else{
                alert("Failed to update voter");
            };
            return response});

            
            return response});
        });        



</script>


{% endblock %}